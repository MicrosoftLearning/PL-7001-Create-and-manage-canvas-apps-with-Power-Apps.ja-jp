---
lab:
  title: 'ラボ 5:外部データ'
  module: 'Module 5: Work with external data in a Power Apps canvas app'
---

# 実習ラボ 5 – 外部データ

このラボでは、外部データ ソースを追加します。

## 学習する内容

- キャンバス アプリに SharePoint リストを追加する方法
- コレクションの使用方法
- Patch の使用方法
- Office365Users コネクタの使用方法

## ラボ手順の概要

- Bookings 用の SharePoint リストを作成する
- SharePoint リストをギャラリーとして追加する
- ギャラリーから選択したレコードを保存する
- Patch を使って予約要求に対する決定を設定する
- Office365User コネクタを使ってユーザーの詳細を表示します。
  
## 前提条件

- 「**ラボ 4: UI を構築する**」を終了している必要があります

## 詳細な手順

## 演習 1 – SharePoint リストを作成する

### タスク 1.1 SharePoint サイトを作成する

1. [Power Apps Maker ポータル](https://make.powerapps.com)で、ブラウザー ウィンドウの左上にある**アプリ起動ツール**を選択し、**[OneDrive]** を選択します。

1. SharePoint で、**[+ サイトの作成]** を選択します。

1. **[チーム サイト]** を選択し、**[Standard team] (標準チーム)** テンプレートを選択して、**[テンプレートの使用]** を選択します。

1. **[サイト名]** に「`Pet boarding`」と入力して、**[次へ]** を選択します。

1. **サイトの作成**を選択します。

1. **[完了]** を選びます。

### タスク 1.2 SharePoint リストを作成する

1. SharePoint サイトで、**[+ 新規]** を選択し、**[リスト]** を選択します。

    ![新しい SharePoint リストのスクリーンショット。](../media/new-sharepoint-list.png)

1. **[空白のリスト]** を選択します

1. **[名前]** に「`Bookings`」と入力して、**[作成]** を選択します。

1. **[列の追加]** を選択し、**[テキスト]** を選択して、**[次へ]** を選択します。

1. **[Create a column] (列の作成)** ペインで、次の値を入力または選択します。

   1. 名前: `Pet Name`
   1. データ型: **1 行のテキスト**

1. **[保存]** を選択します。

1. **[列の追加]** を選択し、**[テキスト]** を選択して、**[次へ]** を選択します。

1. **[Create a column] (列の作成)** ペインで、次の値を入力または選択します。

   1. 名前: `Owner Name`
   1. データ型: **1 行のテキスト**

1. **[保存]** を選択します。

1. **[列の追加]** を選択し、**[日付と時刻]** を選択して、**[次へ]** を選択します。

1. **[Create a column] (列の作成)** ペインで、次の値を入力または選択します。

   1. 名前: `Start Date`
   1. データ型: **日付と時刻**

1. **[保存]** を選択します。

1. **[列の追加]** を選択し、**[日付と時刻]** を選択して、**[次へ]** を選択します。

1. **[Create a column] (列の作成)** ペインで、次の値を入力または選択します。

   1. 名前: `End Date`
   1. データ型: **日付と時刻**

1. **[保存]** を選択します。

1. SharePoint サイトの URL の最初の部分をコピーします (例: `https://m365x99999999.sharepoint.com/sites/Petboarding/`)

## 演習 2 – キャンバス アプリに SharePoint リストを追加する

### タスク 2.1 - アプリを編集する

1. Power Apps Maker ポータル <https://make.powerapps.com> に移動します。

1. **Dev One** 環境にいることを確認します。

1. 左側のメニューから **[アプリ]** タブを選択します。

1. **[予約要求アプリ]** を選択し、コマンド (**...**) を選んで、**[編集] > [新しいタブで編集]** を選択します。

### タスク 2.2 - SharePoint をデータ ソースとして追加する

1. アプリの作成メニューで **データ** を選択します。

1. **[データの追加]** の横にあるドロップダウン キャレットを選択し、**[検索]** に「`SharePoint`」と入力します。

    ![データ ソースとして SharePoint を選択するスクリーンショット。](../media/studio-data-sharepoint.png)

1. **SharePoint** を選択します。

1. **[直接接続 (クラウド サービス)]** を選択し、**[接続]** を選択します。

1. このラボで前に作成した SharePoint サイトの URL を入力します

    ![SharePoint サイトに接続するスクリーンショット。](../media/select-sharepoint-site.png)

1. **[接続]** を選択します。

1. **[Bookings]** を選択します。

    ![SharePoint リストに接続するスクリーンショット。](../media/select-sharepoint-list.png)

1. **[接続]** を選択します。

### タスク 2.3 - SharePoint リストのギャラリーを追加する

1. アプリの作成メニューで、**[挿入 (+)]** を選択します。

1. **垂直ギャラリー**を選択します。

1. データ ソースに **[Bookings]** を選択します。

1. **[レイアウト]** に **[タイトルとサブタイトル]** を選択します。

1. **[フィールド]** の横にある **[6 件選択済み]** を選択します

1. **[タイトル]** に **[Decision] (決定)** を選択します。

1. **[サブタイトル]** に **[Start Date] (開始日)** を選択します。

1. データ ウィンドウを閉じます。

1. アプリの作成メニューで、**[ツリー ビュー]** を選択します。

1. ギャラリーの名前を `BookingList` に変更します。

1. ギャラリーのプロパティを次のように設定します。

   1. X=`1000`
   1. Y=`80`
   1. Height=`575`
   1. Width=`250`

## 演習 3 – コレクション

### タスク 3.1 コレクションの作成

1. アプリの作成メニューで、**[ツリー ビュー]** を選択します。

1. **[BookingRequestList]** を展開します。

1. **[NextArrow]** を選択します。

1. NextArrow の **[OnSelect]** プロパティを次の値に設定します。

    ```powerappsfl
    Collect(colRequests, ThisItem)
    ```

1. アプリの作成メニューで、**[ツリー ビュー]** を選択します。

1. **アプリ** オブジェクトを選択します。

1. NextArrow の **[OnStart]** プロパティを次の値に設定します。

    ```powerappsfl
    Clear(colRequests)
    ```

## 演習 4 – Patch

### タスク 4.1 予約要求を拒否する

1. アプリの作成メニューで、**[ツリー ビュー]** を選択します。

1. **[BookingRequestList]** を選択します。

1. ギャラリー コントロールの左上にある**鉛筆**アイコンを選択します。

    ![ギャラリーの編集のスクリーンショット。](../media/edit-gallery.png)

1. アプリの作成メニューで、**[挿入 (+)]** を選択します。

1. **[アイコン]** を展開します。

1. **[ブロック]** を選択します。 アイコンがギャラリーの各行に追加されます。

    ![ギャラリーの編集のスクリーンショット。](../media/icon-added-gallery.png)

1. アイコンのプロパティを次のように設定します。

   1. X=`150`
   1. Y=`40`
   1. Height=`30`
   1. Width=`30`

1. アプリの作成メニューで、**[ツリー ビュー]** を選択します。

1. アイコンの名前を「`DeclineIcon`」に変更します。

1. **DeclineIcon** の **OnSelect** プロパティを次の値に設定します。

    ```powerappsfl
    Patch('Booking Requests', ThisItem, {Decision: 'Decision (Booking Requests)'.Declined})
    ```

## 演習 5 – Office 365 ユーザー

### タスク 5.1 Office 365 ユーザーをデータ ソースとして追加する

1. アプリの作成メニューで **データ** を選択します。

1. **[データの追加]** の横にあるドロップダウン キャレットを選択し、**[検索]** に「`Office 365`」と入力します。

1. **Office 365 ユーザー**を選択します。

1. **[接続]** を選択します。

### タスク 5.2 ユーザーの国を表示する

1. ギャラリーの外側でキャンバスの空いている部分をクリックします。

1. アプリの作成メニューで、**[挿入 (+)]** を選択します。

1. **テキスト ラベル**を選択します。

1. 画面の右上、UserLabel の横にラベルをドラッグします。

1. アプリの作成メニューで、**[ツリー ビュー]** を選択します。

1. ラベルの名前を `UserDetailsLabel` に変更します。

1. **UserDetailsLabel** の **OnSelect** プロパティを次の値に設定します。

    ```powerappsfl
    Office365Users.MyProfile().Country
    ```

1. Power Apps Studio の右上にある **[保存]** を選択します。

1. コマンド バーの左上にある **[<- 戻る]** ボタンを選択し、**[終了]** を選んでアプリを終了します。
